<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Integrating Vert.x</title>

    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">

</head>
<body>


<div class="pct-bar-chart-pf">
    <div class="pct-bar-chart-pf-chart">
        <div id="causes"></div>
    </div>
</div>


</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/0.3.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vertx/3.5.4/vertx-eventbus.js"></script>
<!-- C3, D3 - Charting Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.5.4/c3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.matchHeight/0.7.2/jquery.matchHeight-min.js"></script>

<script>
    var causes = [
        'BulkRevokeBias',
        'CGC_Operation',
        'Cleanup',
        'EnableBiasedLocking',
        'Exit',
        'G1CollectForAllocation',
        'RevokeBias'
    ];

    var columnsData = ['causes', 0, 0, 0, 0, 0, 0, 0];

    var indexes = {
        'BulkRevokeBias': 1,
        'CGC_Operation': 2,
        'Cleanup': 3,
        'EnableBiasedLocking': 4,
        'Exit': 5,
        'G1CollectForAllocation': 6,
        'RevokeBias': 7
    };

    $(document).ready(function () {
        // Init chart
        var c3ChartDefaults = $().c3ChartDefaults();


        var categories = causes;

        var verticalBarChartConfig = $().c3ChartDefaults().getDefaultBarConfig(categories);
        verticalBarChartConfig.bindto = '#causes';
        verticalBarChartConfig.axis = {
            x: {
                categories: categories,
                type: 'category'
            }
        };
        verticalBarChartConfig.data = {
            type: 'bar',
            columns: [columnsData]
        };
        var chart = c3.generate(verticalBarChartConfig);


        var eb = new EventBus("/eventbus");
        eb.onopen = function () {
            eb.registerHandler("safepoints", function (err, msg) {
                var cause = msg.body;

                $.each(cause, function (key, count) {
                    var index = indexes[key];
                    columnsData[index] = count;
                });

                chart.load({
                    columns: [columnsData]
                });
            });
        };
    });
</script>

</html>